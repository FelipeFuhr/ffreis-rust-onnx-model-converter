ARG UV_VENV_IMAGE=ffreis/onnx-converter-uv-venv
FROM ${UV_VENV_IMAGE}

ARG EXTRAS=all

ENV VIRTUAL_ENV=/opt/venv
ENV PATH="/opt/venv/bin:${PATH}"

WORKDIR /app

COPY --chown=appuser:appgroup pyproject.toml README.md /app/
COPY --chown=appuser:appgroup src /app/src

USER root
RUN uv pip install --python /opt/venv/bin/python ".[${EXTRAS}]"
RUN chown -R appuser:appgroup /app /opt/venv
USER appuser:appgroup
