ARG BASE_IMAGE=__BASE_IMAGE__
ARG BASE_DIGEST=__BASE_DIGEST__
FROM ${BASE_IMAGE}@${BASE_DIGEST}

# Create unprivileged user
RUN (getent group appgroup >/dev/null 2>&1 || groupadd -g 10001 appgroup) \
    && (id -u appuser >/dev/null 2>&1 || useradd -u 10001 -g appgroup -m -s /usr/sbin/nologin appuser)

# Create app dir with correct ownership
RUN install -d -m 0750 -o appuser -g appgroup /app
WORKDIR /app

USER appuser:appgroup
